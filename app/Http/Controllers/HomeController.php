<?php

declare(strict_types=1);

namespace App\Http\Controllers;

use App\Models\Faq;
use App\Models\Review;
use Carbon\Carbon;
use Illuminate\Contracts\View\View;

class HomeController extends Controller
{
    public function index(): View
    {
        $reviews = Review::query()
            ->where('is_visible', true)
            ->orderByRaw('COALESCE(review_date, created_at) DESC')
            ->take(6)
            ->get();

        if ($reviews->isEmpty()) {
            $reviews = collect([
                (object)['author' => 'Анна К.', 'text' => 'Спасибо огромное! Помогли выбраться из сложной ситуации. Менеджер Ольга очень внимательная, все объяснила, предложила удобную рассрочку. Теперь спокойно выплачиваю по 3000 рублей в месяц.', 'rating' => 5, 'photo' => null, 'review_date' => Carbon::parse('2025-01-15'), 'created_at' => Carbon::parse('2025-01-15')],
                (object)['author' => 'Дмитрий П.', 'text' => 'Долг был большой — больше 200 тысяч. Думал, никогда не расплачусь. Ребята сделали скидку 20%, разбили на 12 месяцев. Уже полгода плачу, без проблем. Рекомендую!', 'rating' => 5, 'photo' => null, 'review_date' => Carbon::parse('2025-01-10'), 'created_at' => Carbon::parse('2025-01-10')],
                (object)['author' => 'Мария С.', 'text' => 'Хороший сервис. Немного долго ждала обратного звонка, но когда связались — все прошло быстро. Оформили рассрочку за один день. Спасибо!', 'rating' => 4, 'photo' => null, 'review_date' => Carbon::parse('2025-01-08'), 'created_at' => Carbon::parse('2025-01-08')],
            ]);
        }

        $faqs = Faq::query()->orderBy('sort_order')->get();

        if ($faqs->isEmpty()) {
            $faqs = collect([
                (object)['question' => 'Кто может воспользоваться вашими услугами?', 'answer' => 'Любой человек, у которого есть задолженность перед кредитором, чьи права перешли к нашей компании. Мы работаем с физическими лицами и индивидуальными предпринимателями.', 'sort_order' => 1],
                (object)['question' => 'Какие документы нужны для оформления рассрочки?', 'answer' => 'Минимальный пакет: паспорт РФ и номер договора (если он у вас сохранился). В некоторых случаях можем попросить справку о доходах для расчета оптимальных условий.', 'sort_order' => 2],
                (object)['question' => 'Можно ли погасить долг досрочно?', 'answer' => 'Да, конечно! Вы можете погасить задолженность полностью или частично в любой момент без штрафов и комиссий. Досрочное погашение только приветствуется.', 'sort_order' => 3],
                (object)['question' => 'Что будет, если я не смогу платить по графику?', 'answer' => 'Мы понимаем, что жизненные обстоятельства бывают разными. Если у вас возникли временные трудности — свяжитесь с нами. Мы готовы пересмотреть условия и найти решение.', 'sort_order' => 4],
                (object)['question' => 'Это законно? Есть ли у вас лицензия?', 'answer' => 'Да, мы работаем абсолютно законно. Наша компания включена в государственный реестр ФССП (№ 4170044007468). Все операции проводятся в рамках действующего законодательства РФ.', 'sort_order' => 5],
            ]);
        }

        return view('welcome', compact('reviews', 'faqs'));
    }
}
